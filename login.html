<!-- login.html: P√°gina de inicio de sesi√≥n de usuarios del Vivero Nuevo Renacer -->
<!DOCTYPE html>
<html lang="es">
<head>
  <!-- Configuraci√≥n b√°sica de codificaci√≥n y comportamiento responsive -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- T√≠tulo que se muestra en la pesta√±a del navegador -->
  <title>Iniciar sesi√≥n - Vivero Nuevo Renacer</title>

  <!-- Descripci√≥n para SEO (texto que leen los buscadores) -->
  <meta name="description" content="Accede a tu cuenta para comprar y administrar tus pedidos en Vivero La Ceiba." />

  <!-- Bootstrap + Icons: estilos base y set de iconos -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Estilos globales del sitio y espec√≠ficos de pantallas de auth (login/registro) -->
  <link rel="stylesheet" href="css/estilos.css">
  <link rel="stylesheet" href="css/auth.css">
</head>
<body>

  <!-- Navbar -->
  <!-- Barra de navegaci√≥n superior con acceso a inicio, cat√°logo y login -->
 <nav class="navbar navbar-expand-lg navbar-dark shadow-sm">
  <div class="container">
    <!-- Marca del sitio: logo + nombre que llevan al inicio -->
    <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
      <img
        src="images/iconovivero.png"
        alt="Vivero Nuevo Renacer"
        class="brand-logo"
        loading="eager"
        decoding="async"
      />
      <span>Vivero Nuevo Renacer</span>
    </a>

    <!-- Bot√≥n hamburguesa para colapsar/mostrar el men√∫ en pantallas peque√±as -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Mostrar navegaci√≥n">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Enlaces de navegaci√≥n -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto align-items-lg-center gap-lg-2">
        <li class="nav-item"><a class="nav-link" href="index.html">Inicio</a></li>
        <li class="nav-item"><a class="nav-link" href="catalogo.html">Cat√°logo</a></li>
        <!-- Enlace actual: p√°gina de Login marcada como activa -->
        <li class="nav-item"><a class="nav-link active" aria-current="page" href="#">Login</a></li>
      </ul>
    </div>
  </div>
</nav>


  <!-- Canvas del login -->
  <!-- Contenedor principal del dise√±o de autenticaci√≥n (lado visual + tarjeta de login) -->
  <main class="auth-canvas">
    <div class="container-auth">
      <!-- Panel visual (desktop) -->
      <!-- Este aside solo se ve en pantallas grandes y sirve de panel informativo/ilustrativo -->
      <aside class="auth-visual d-none d-lg-flex">
        <!-- Capa de color/sombra por encima de la imagen de fondo (definida en CSS) -->
        <div class="visual-overlay"></div>
        <div class="visual-content">
          <!-- Insignia con icono para reforzar la tem√°tica del vivero -->
          <div class="visual-badge">üå±</div>
          <h2>¬°Nos alegra verte!</h2>
          <p class="text-opacity">Accede para comprar m√°s r√°pido, guardar tu lista de deseos y seguir tus pedidos.</p>
          <!-- Lista de beneficios que el usuario obtiene al iniciar sesi√≥n -->
          <ul class="benefits">
            <li><i class="bi bi-bag-check"></i> Pagos y env√≠os m√°s √°giles</li>
            <li><i class="bi bi-heart"></i> Lista de Deseos y recomendaciones</li>
            <li><i class="bi bi-headset"></i> Soporte y asesor√≠a</li>
          </ul>
        </div>
      </aside>

      <!-- Tarjeta de acceso -->
      <!-- Secci√≥n principal donde el usuario ingresa sus credenciales -->
      <section class="auth-card">
        <div class="auth-card__inner">
          <!-- Encabezado de la tarjeta de login -->
          <div class="text-center mb-3">
            <!-- Marca visual (c√≠rculo/loguito) manejada por CSS -->
            <div class="brand-mark"></div>
            <h1 class="h4 mb-1">Iniciar sesi√≥n</h1>
            <p class="text-muted small mb-0">Bienvenido de vuelta</p>
          </div>

          <!-- Formulario de inicio de sesi√≥n -->
          <!-- Uso validaci√≥n nativa HTML5 + clases de Bootstrap -->
          <form id="loginForm" class="needs-validation" novalidate>
            <!-- Usuario / Email -->
            <!-- Campo donde el usuario puede escribir su usuario o correo -->
            <div class="form-floating mb-3 position-relative">
              <input type="text" class="form-control" id="loginIdentifier" placeholder="usuario o correo"
                     required autocomplete="username" maxlength="80">
              <label for="loginIdentifier">Usuario o correo</label>
              <div class="invalid-feedback">Ingresa tu usuario o un correo v√°lido.</div>
            </div>

            <!-- Contrase√±a + ojo fuera del campo -->
            <!-- Agrupo campo de contrase√±a + bot√≥n de ojo en una sola fila -->
            <div class="d-flex align-items-stretch gap-2 mb-1">
              <!-- Campo de contrase√±a como floating label -->
              <div class="form-floating flex-grow-1 position-relative">
                <input type="password" class="form-control" id="loginPassword" placeholder="Contrase√±a"
                       required autocomplete="current-password" minlength="6" maxlength="72">
                <label for="loginPassword">Contrase√±a</label>
                <div class="invalid-feedback">La contrase√±a es obligatoria (m√≠nimo 6 caracteres).</div>
              </div>
              <!-- Bot√≥n para mostrar/ocultar la contrase√±a (ojo) -->
              <button type="button" class="btn btn-eye" id="togglePassword"
                      aria-label="Mostrar u ocultar contrase√±a"
                      style="border:none;outline:none;box-shadow:none">
                <i class="bi bi-eye"></i>
              </button>
            </div>

            <!-- Medidor de fuerza -->
            <!-- Indicador visual de qu√© tan fuerte es la contrase√±a que va escribiendo el usuario -->
            <div class="strength mt-2" aria-live="polite">
              <div class="strength-bar" id="strengthBar"></div>
              <span id="strengthLabel" class="strength-label">Fuerza: ‚Äî</span>
            </div>

            <!-- Aviso cuando Bloq May√∫s est√° activo mientras se escribe la contrase√±a -->
            <div id="capsWarning" class="form-text text-warning small d-none mt-2">
              <i class="bi bi-exclamation-triangle"></i> Bloq May√∫s activado.
            </div>

            <!-- Opciones -->
            <!-- Contiene el "Recordarme" y el enlace para recuperar contrase√±a -->
            <div class="d-flex justify-content-between align-items-center my-3">
              <!-- Checkbox para recordar sesi√≥n (decidir√© si uso localStorage o sessionStorage en JS) -->
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="rememberMe">
                <label class="form-check-label" for="rememberMe">Recordarme</label>
              </div>
              <!-- Bot√≥n que abre el modal de recuperar contrase√±a -->
              <button class="btn btn-link p-0 text-decoration-none" type="button" data-bs-toggle="modal" data-bs-target="#recoverModal">
                ¬øOlvidaste tu contrase√±a?
              </button>
            </div>

            <!-- Botones -->
            <!-- Bot√≥n principal de login + enlace a la p√°gina de registro -->
            <div class="d-grid gap-2 mt-2">
              <!-- Bot√≥n de enviar formulario con spinner integrado -->
              <button id="btnLogin" class="btn btn-custom" type="submit">
                <span class="btn-label">Iniciar sesi√≥n</span>
                <!-- Spinner que muestro mientras realizo la petici√≥n al backend -->
                <span class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
              </button>
              <!-- Enlace para ir a crear una nueva cuenta -->
              <a href="registro.html" class="btn btn-outline-success">Crear cuenta</a>
            </div>
          </form>

          <!-- Aviso legal de t√©rminos y privacidad (enlaces de ejemplo) -->
          <p class="text-center mt-3 small text-muted">
            Al continuar aceptas nuestros <a href="#" class="link-success">T√©rminos</a> y <a href="#" class="link-success">Privacidad</a>.
          </p>
        </div>
      </section>
    </div>
  </main>

  <!-- Modal: Recuperar contrase√±a -->
  <!-- Modal donde el usuario pone su correo para recibir un enlace de recuperaci√≥n (simulado) -->
  <div class="modal fade" id="recoverModal" tabindex="-1" aria-labelledby="recoverLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <!-- Formulario interno del modal (no hace llamada real, solo simulo con JS) -->
        <form id="recoverForm" novalidate>
          <div class="modal-header">
            <h5 class="modal-title" id="recoverLabel">Recuperar contrase√±a</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <!-- Campo para que el usuario escriba su correo -->
            <div class="form-floating">
              <input type="email" class="form-control" id="recoverEmail" placeholder="correo@ejemplo.com" required>
              <label for="recoverEmail">Correo electr√≥nico</label>
              <div class="invalid-feedback">Ingresa un correo v√°lido para enviarte el enlace.</div>
            </div>
          </div>
          <div class="modal-footer">
            <!-- Bot√≥n para cerrar el modal sin hacer nada -->
            <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancelar</button>
            <!-- Bot√≥n que dispara el flujo simulado de recuperaci√≥n -->
            <button id="btnRecover" class="btn btn-custom" type="submit">
              <span class="btn-label">Enviar enlace</span>
              <span class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Toasts -->
  <!-- Contenedor para mostrar notificaciones flotantes (√©xito/error) relacionadas al login o recuperaci√≥n -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index:1100;">
    <div id="toastAuth" class="toast align-items-center border-0" role="status" aria-live="polite" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">Listo.</div>
        <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Cerrar"></button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <!-- Script de Bootstrap (JS) para manejar modales, toasts, etc. -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!--  Script de login: maneja validaci√≥n, fuerza, ojo, Bloq May√∫s y llamada al backend -->
  <script>
  (function(){
   // URL base de mi API backend 
   const API = 'https://vivero-back.onrender.com';

    // Referencias a los elementos del DOM que voy a usar
    const form = document.getElementById('loginForm');
    const inputId = document.getElementById('loginIdentifier');
    const inputPw = document.getElementById('loginPassword');
    const btnLogin = document.getElementById('btnLogin');
    const spinner = btnLogin.querySelector('.spinner-border');
    const remember = document.getElementById('rememberMe');

    // Configuraci√≥n del toast para mostrar mensajes de feedback
    const toastEl = document.getElementById('toastAuth');
    const toast = new bootstrap.Toast(toastEl);

    // Funci√≥n reutilizable para mostrar el toast con mensaje y tipo (√©xito o error)
    function showToast(msg, type='success'){
      const body = toastEl.querySelector('.toast-body');
      body.textContent = msg;
      // Limpio clases previas de color
      toastEl.classList.remove('bg-danger','bg-success','text-white');
      // Aplico clases seg√∫n el tipo
      if(type==='success'){ toastEl.classList.add('bg-success','text-white'); }
      else { toastEl.classList.add('bg-danger','text-white'); }
      toast.show();
    }

    // Validaci√≥n HTML5 + Bootstrap
    // Manejador del env√≠o del formulario de login
    form.addEventListener('submit', async (e) => {
      e.preventDefault(); // Evito el env√≠o normal del formulario
      form.classList.add('was-validated'); // Activo estilos de validaci√≥n de Bootstrap

      // Si el formulario no cumple validaciones HTML5, no sigo
      if (!form.checkValidity()) return;

      // Deshabilito el bot√≥n y muestro el spinner mientras hago la petici√≥n
      btnLogin.disabled = true;
      spinner.classList.remove('d-none');

      const identifier = inputId.value.trim();
      const password = inputPw.value;

      try {
        // Llamada al endpoint de login de mi backend
        const res = await fetch(API + '/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ identifier, password })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Error al iniciar sesi√≥n');

        // Seg√∫n el checkbox "Recordarme" decido si guardo en localStorage o sessionStorage
        const store = remember.checked ? localStorage : sessionStorage;
        store.setItem('token', data.token);
        store.setItem('user', JSON.stringify(data.user));

        // Muestro mensaje de √©xito y redirijo al inicio despu√©s de un corto tiempo
        showToast('¬°Sesi√≥n iniciada!');
        setTimeout(() => { window.location.href = 'inicio.html'; }, 800);
      } catch (err) {
        // Si algo falla, muestro error en el toast
        showToast(err.message || 'Credenciales inv√°lidas', 'danger');
      } finally {
        // Restauro el bot√≥n y oculto el spinner sin importar si sali√≥ bien o mal
        btnLogin.disabled = false;
        spinner.classList.add('d-none');
      }
    });

    // Ojo de contrase√±a (fuera del campo)
    // Alterno entre mostrar la contrase√±a en texto y ocultarla
    document.getElementById('togglePassword').addEventListener('click', () => {
      const isText = inputPw.type === 'text';
      inputPw.type = isText ? 'password' : 'text';
      const icon = document.querySelector('#togglePassword i');
      // Cambio el icono seg√∫n el estado (ojo abierto/cerrado)
      icon.classList.toggle('bi-eye');
      icon.classList.toggle('bi-eye-slash');
      inputPw.focus();
    });

    // Aviso de Bloq May√∫s
    // Detecto si el usuario tiene activado el CapsLock al escribir la contrase√±a
    inputPw.addEventListener('keyup', (e) => {
      const on = e.getModifierState && e.getModifierState('CapsLock');
      document.getElementById('capsWarning').classList.toggle('d-none', !on);
    });

    // Medidor de fuerza de contrase√±a (informativo)
    const bar = document.getElementById('strengthBar');
    const label = document.getElementById('strengthLabel');

    // Funci√≥n que calcula un puntaje b√°sico seg√∫n longitud y tipos de caracteres
    function score(pw){
      let s = 0;
      if (pw.length >= 6) s++;
      if (pw.length >= 10) s++;
      if (/[A-Z]/.test(pw)) s++;
      if (/[0-9]/.test(pw)) s++;
      if (/[^A-Za-z0-9]/.test(pw)) s++;
      return s; // 0..5
    }

    // Cada vez que se escribe algo en la contrase√±a actualizo la barra y el texto
    inputPw.addEventListener('input', () => {
      const s = score(inputPw.value);
      const pct = Math.min(s * 20, 100);
      bar.style.width = pct + '%';
      bar.classList.remove('bg-danger','bg-warning','bg-success');

      if (s <= 2) {
        bar.classList.add('bg-danger');
        label.textContent = 'Fuerza: d√©bil';
      }
      else if (s === 3) {
        bar.classList.add('bg-warning');
        label.textContent = 'Fuerza: media';
      }
      else {
        bar.classList.add('bg-success');
        label.textContent = 'Fuerza: fuerte';
      }

      // Si no hay nada escrito, reseteo el medidor
      if (!inputPw.value) {
        label.textContent = 'Fuerza: ‚Äî';
        bar.style.width = '0%';
        bar.classList.remove('bg-danger','bg-warning','bg-success');
      }
    });

    // Recuperar contrase√±a (simulado)
    // Manejo el submit del formulario del modal de recuperaci√≥n
    const recoverForm = document.getElementById('recoverForm');
    recoverForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('recoverEmail').value.trim();

      // Validaci√≥n sencilla del formato del correo
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email)) {
        recoverForm.classList.add('was-validated');
        return;
      }

      // Cierro el modal manualmente
      const modalEl = document.getElementById('recoverModal');
      const modal = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
      modal.hide();

      // Mensaje informativo (l√≥gica real de recuperaci√≥n no est√° implementada)
      showToast('Si el correo existe, enviaremos un enlace para recuperar tu contrase√±a.');
    });
  })();
  </script>

</body>
</html>
